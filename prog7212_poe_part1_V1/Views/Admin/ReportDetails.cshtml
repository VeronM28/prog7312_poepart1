@model prog7212_poe_part1_V1.Models.ReportModel

@{
    ViewData["Title"] = $"Report Details - #{Model.Id}";
}

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="@Url.Action("Dashboard", "Admin")">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="@Url.Action("Reports", "Admin")">Reports</a></li>
                    <li class="breadcrumb-item active">Report #@Model.Id</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header pb-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">Report #@Model.Id</h4>
                        @{
                            string statusClass = Model.Status switch
                            {
                                "Pending" => "bg-warning text-dark",
                                "In-Progress" => "bg-info",
                                "Completed" => "bg-success",
                                _ => "bg-secondary"
                            };
                        }
                        <span class="badge @statusClass fs-6">@Model.Status</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Category</h6>
                            <p class="text-sm mb-0">
                                <span class="badge bg-secondary">@Model.Category</span>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Location</h6>
                            <p class="text-sm mb-0">
                                <i class="fas fa-map-marker-alt text-warning"></i> @Model.Location
                            </p>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Description</h6>
                            <p class="text-sm">@Model.Description</p>
                        </div>
                    </div>

                    @if (!string.IsNullOrEmpty(Model.ImagePath))
                    {
                        <div class="row mb-4">
                            <div class="col-12">
                                <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Attached Image</h6>
                                <div class="text-center">
                                    <img src="@Model.ImagePath"
                                         alt="Report Image"
                                         class="img-fluid rounded shadow"
                                         style="max-height: 400px; max-width: 100%;"
                                         data-bs-toggle="modal"
                                         data-bs-target="#imageModal"
                                         style="cursor: pointer;" />
                                    <p class="text-xs text-muted mt-2">Click to view full size</p>
                                </div>
                            </div>
                        </div>

                        <!-- Image Modal -->
                        <div class="modal fade" id="imageModal" tabindex="-1">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Report Image</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body text-center">
                                        <img src="@Model.ImagePath" alt="Report Image" class="img-fluid" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    }

                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Actions</h6>
                            <div class="btn-group" role="group">
                                <form method="post" asp-action="UpdateStatus" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="reportId" value="@Model.Id" />
                                    <input type="hidden" name="status" value="Pending" />
                                    <button type="submit"
                                            class="btn btn-outline-warning btn-sm"
                                    @(Model.Status == "Pending" ? "disabled" : "")
                                            onclick="return confirm('Update status to Pending?')">
                                        <i class="fas fa-clock"></i> Mark as Pending
                                    </button>
                                </form>

                                <form method="post" asp-action="UpdateStatus" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="reportId" value="@Model.Id" />
                                    <input type="hidden" name="status" value="In-Progress" />
                                    <button type="submit"
                                            class="btn btn-outline-info btn-sm"
                                    @(Model.Status == "In-Progress" ? "disabled" : "")
                                            onclick="return confirm('Update status to In-Progress?')">
                                        <i class="fas fa-spinner"></i> Mark as In-Progress
                                    </button>
                                </form>

                                <form method="post" asp-action="UpdateStatus" class="d-inline">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="reportId" value="@Model.Id" />
                                    <input type="hidden" name="status" value="Completed" />
                                    <button type="submit"
                                            class="btn btn-outline-success btn-sm"
                                    @(Model.Status == "Completed" ? "disabled" : "")
                                            onclick="return confirm('Mark this report as Completed?')">
                                        <i class="fas fa-check"></i> Mark as Completed
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Report Information Sidebar -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header pb-0">
                    <h6>Report Information</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Report ID</h6>
                        <p class="text-sm mb-0">#@Model.Id</p>
                    </div>

                    <div class="mb-3">
                        <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Submitted By</h6>
                        <p class="text-sm mb-0">
                            <i class="fas fa-user text-primary"></i>
                            @(Model.User?.UserName ?? "Unknown User")
                        </p>
                        @if (!string.IsNullOrEmpty(Model.User?.Email))
                        {
                            <p class="text-xs text-muted mb-0">
                                <i class="fas fa-envelope"></i> @Model.User.Email
                            </p>
                        }
                    </div>

                    <div class="mb-3">
                        <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Date Submitted</h6>
                        <p class="text-sm mb-0">
                            <i class="fas fa-calendar text-info"></i>
                            @Model.DateSubmitted.ToString("MMMM dd, yyyy")
                        </p>
                        <p class="text-xs text-muted mb-0">
                            <i class="fas fa-clock"></i>
                            @Model.DateSubmitted.ToString("HH:mm")
                        </p>
                    </div>

                    <div class="mb-3">
                        <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Current Status</h6>
                        <p class="text-sm mb-0">
                            <span class="badge @statusClass">@Model.Status</span>
                        </p>
                    </div>

                    <div class="mb-3">
                        <h6 class="text-uppercase text-body text-xs font-weight-bolder mb-1">Days Since Submission</h6>
                        <p class="text-sm mb-0">
                            @{
                                var daysSince = (DateTime.Now - Model.DateSubmitted).Days;
                                string daysClass = daysSince switch
                                {
                                    <= 1 => "text-success",
                                    <= 7 => "text-warning",
                                    _ => "text-danger"
                                };
                            }
                            <span class="@daysClass font-weight-bold">@daysSince days</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Quick Actions Card -->
            <div class="card mt-4">
                <div class="card-header pb-0">
                    <h6>Quick Actions</h6>
                </div>
                <div class="card-body">
                    <a href="@Url.Action("Reports", "Admin")" class="btn btn-outline-primary btn-sm btn-block mb-2">
                        <i class="fas fa-arrow-left"></i> Back to All Reports
                    </a>
                    <a href="@Url.Action("Reports", "Admin", new { category = Model.Category })"
                       class="btn btn-outline-secondary btn-sm btn-block mb-2">
                        <i class="fas fa-filter"></i> View @Model.Category Reports
                    </a>
                    <a href="@Url.Action("Reports", "Admin", new { status = Model.Status })"
                       class="btn btn-outline-info btn-sm btn-block">
                        <i class="fas fa-list"></i> View @Model.Status Reports
                    </a>
                </div>
            </div>
        </div>
    </div>
    }
